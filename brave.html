 <!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GOopedia - Buscador de Libros</title>
<style>
body { font-family: Arial, sans-serif; background:#fff; color:#000; padding:20px; }
h1 { text-align:center; }
input { width:70%; padding:8px; font-size:16px; margin-right:8px; }
button { padding:8px 12px; font-size:16px; cursor:pointer; margin-right:6px; }
#visorLibro { margin-top:20px; padding:15px; border:1px solid #ccc; border-radius:5px; min-height:300px; background:#f9f9f9; }
#iframeVisor { width:100%; height:600px; border:0; display:none; }
.loading { color: #666; }
.error { color: red; }
small { color:#666; display:block; margin-top:8px; }
</style>
</head>
<body>

<h1>GOopedia - Buscador de Libros</h1>

<p>Escribe el nombre del libro (sin extensión) y presiona "Cargar". Ej: <code>sum</code></p>

<input type="text" id="nombreLibro" placeholder="Ej: sum">
<button id="btnCargar">Cargar (abrir en iframe)</button>
<button id="btnFetch">Cargar (insertar HTML)</button>
<button id="btnAbrirNueva">Abrir en nueva pestaña</button>

<small>Asegúrate de escribir el nombre exacto (sensitivo a mayúsculas/minúsculas).</small>

<div id="visorLibro">
  <p class="loading" id="status" style="display:none;">Cargando...</p>
  <iframe id="iframeVisor" title="Visor de libro"></iframe>
</div>

<script>
/*
  Ajusta esta variable si tus libros están en una subcarpeta, por ejemplo:
  const baseFolder = 'books/'; 
  Si están en la misma carpeta que index.html, deja ''.
*/
const baseFolder = ''; // <-- CAMBIAR si es necesario, p.ej. 'books/'

const visor = document.getElementById('visorLibro');
const status = document.getElementById('status');
const iframe = document.getElementById('iframeVisor');

function sanitizeName(name) {
  // rechaza rutas con barras o subidas de nivel
  if (!name) return null;
  if (/[\\/]/.test(name) || name.includes('..')) return null;
  return name;
}

function showStatus(text) {
  status.style.display = 'block';
  status.textContent = text;
}
function hideStatus() {
  status.style.display = 'none';
}

document.getElementById('btnCargar').addEventListener('click', () => {
  const raw = document.getElementById('nombreLibro').value.trim();
  const safe = sanitizeName(raw);
  if (!safe) {
    alert('Nombre inválido. No uses barras ni ".." y asegúrate de escribir algo.');
    return;
  }
  const url = `${baseFolder}${encodeURIComponent(safe)}.html`;
  // Opción recomendada: cargar en iframe (ejecuta scripts/estilos del documento cargado)
  iframe.src = url;
  iframe.style.display = 'block';
  showStatus('Cargando en iframe...');
  // limpiar cualquier contenido insertado previamente
  iframe.onload = () => {
    hideStatus();
  };
  iframe.onerror = () => {
    hideStatus();
    iframe.style.display = 'none';
    visor.innerHTML = '<p class="error">No se pudo cargar el libro en iframe (404 o error).</p>';
    console.error('Error al cargar iframe', url);
  };
});

document.getElementById('btnFetch').addEventListener('click', () => {
  const raw = document.getElementById('nombreLibro').value.trim();
  const safe = sanitizeName(raw);
  if (!safe) {
    alert('Nombre inválido. No uses barras ni ".." y asegúrate de escribir algo.');
    return;
  }
  const url = `${baseFolder}${encodeURIComponent(safe)}.html`;
  // Opción: fetch e insertar el HTML dentro del div (LOS SCRIPTS NO SE EJECUTARÁN)
  showStatus('Cargando contenido...');
  iframe.style.display = 'none';
  fetch(url)
    .then(res => {
      if (!res.ok) throw new Error('Libro no encontrado');
      return res.text();
    })
    .then(html => {
      hideStatus();
      // Si prefieres ejecutar scripts del HTML insertado, haría falta parsing adicional.
      document.getElementById('visorLibro').innerHTML = html;
    })
    .catch(err => {
      hideStatus();
      document.getElementById('visorLibro').innerHTML = '<p class="error">Libro no encontrado.</p>';
      console.error(err);
    });
});

document.getElementById('btnAbrirNueva').addEventListener('click', () => {
  const raw = document.getElementById('nombreLibro').value.trim();
  const safe = sanitizeName(raw);
  if (!safe) {
    alert('Nombre inválido. No uses barras ni ".." y asegúrate de escribir algo.');
    return;
  }
  const url = `${baseFolder}${encodeURIComponent(safe)}.html`;
  window.open(url, '_blank');
});
</script>

</body>
</html>